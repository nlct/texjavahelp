% This is adapted from nlctuserguide.sty which already has some support
% in the TeX Parser Library.
\NeedsTeXFormat{LaTeX2e}

\ProvidesPackage{texjavahelp}[2024/03/16 v0.1a (NLCT)]

\RequirePackage{pifont}
\RequirePackage{fontawesome}
\RequirePackage{twemojis}
\RequirePackage{upquote}
\RequirePackage{hologo}
\RequirePackage{varioref}
\RequirePackage{xcolor}
\RequirePackage{graphicx}
\RequirePackage{accsupp}
\RequirePackage{tikz}

\PassOptionsToPackage{breakable,skins,listings}{tcolorbox}
\RequirePackage{tcolorbox}

\PassOptionsToPackage{
 record=nameref,
 indexcounter,
 floats,
 nostyles,
 stylemods={tree,bookindex,topic},
 style=alttree
}{glossaries-extra}

\newcommand{\nlct@ns@ref@cs}{\vref}
  
\newcommand{\nlctnovref}{\renewcommand{\nlct@ns@ref@cs}{\ref}}
\newcommand{\nlctusevref}{\renewcommand{\nlct@ns@ref@cs}{\vref}}
    
\DeclareOption{vref}{\nlctusevref}
\DeclareOption{novref}{\nlctnovref}

\newcommand{\nlct@definesymbols}{%
  \nlct@definetikzsymbols
}

\newrobustcmd{\leftkeysym}{%
 \BeginAccSupp{method=hex,unicode,ActualText=2190}%
 \faArrowLeft
 \EndAccSupp{}%
}

\newrobustcmd{\upkeysym}{%
 \BeginAccSupp{method=hex,unicode,ActualText=2191}%
 \faArrowUp
 \EndAccSupp{}%
}

\newrobustcmd{\rightkeysym}{%
 \BeginAccSupp{method=hex,unicode,ActualText=2192}%
 \faArrowRight
 \EndAccSupp{}%
}

\newrobustcmd{\downkeysym}{%
 \BeginAccSupp{method=hex,unicode,ActualText=2193}%
 \faArrowDown
 \EndAccSupp{}%
}

\newrobustcmd{\backspacekeysym}{%
 \BeginAccSupp{method=hex,unicode,ActualText=232B}%
 \faBackspace
 \EndAccSupp{}%
}

\newrobustcmd{\spacekeysym}{%
 \BeginAccSupp{method=hex,unicode,ActualText=0020}%
 \qquad
 \EndAccSupp{}%
}

\newcommand{\nlct@definefontsymbols}{%
% requires stix or boisk
 \newrobustcmd{\tabsym}{%
  \BeginAccSupp{method=hex,unicode,ActualText=21B9}%
  \ensuremath{\barleftarrowrightarrowbar}%
 \EndAccSupp{}%
 }
% requires stix
 \newrobustcmd{\upsym}{%
  \BeginAccSupp{method=hex,unicode,ActualText=2B71}%
  \ensuremath{\baruparrow}%
  \EndAccSupp{}%
 }
% requires boisik or stix
 \newrobustcmd{\returnsym}{%
  \BeginAccSupp{method=hex,unicode,ActualText=21B5}%
  \ensuremath{\carriagereturn}%
  \EndAccSupp{}%
 }
 \newrobustcmd{\shiftsym}{%
  \BeginAccSupp{method=hex,unicode,ActualText=21E7}%
  \ensuremath{\upwhitearrow}%
  \EndAccSupp{}%
 }
}

\newcommand{\nlct@definetikzsymbols}{%
  \usetikzlibrary{arrows.meta}%
  \newsavebox\tabsbox
  \sbox\tabsbox{%
   \resizebox{!}{8pt}{%
   \begin{tikzpicture}[thick]
   \draw[arrows={Bar[width=8pt]Triangle[width=6pt,length=5pt]-}]
     (0,0) -- (14pt,0);
   \draw[arrows={-Triangle[width=6pt,length=5pt]Bar[width=8pt]}]
     (0,-7pt) -- (14pt,-7pt);
   \end{tikzpicture}%
   }%
  }
  \newrobustcmd{\tabsym}{%
   \BeginAccSupp{method=hex,unicode,ActualText=21B9}%
   \thinspace
   \usebox\tabsbox
   \thinspace
   \EndAccSupp{}%
  }%
  \newsavebox\upsymbox
  \sbox\upsymbox{%
   \begin{tikzpicture}
   \draw[arrows={-To[width=6pt,length=5pt]Bar[width=8pt]}]
   (0,0) -- (0,2ex);
   \end{tikzpicture}
  }%
  \newrobustcmd{\upsym}{%
   \BeginAccSupp{method=hex,unicode,ActualText=2B71}%
   \usebox\upsymbox
   \EndAccSupp{}%
  }%
 \newsavebox\returnbox
 \sbox\returnbox{%
   \begin{tikzpicture}
   \draw [thick,arrows={Triangle[width=4pt,length=4pt]-}]
   (0,0) -| (1em,1ex);
   \end{tikzpicture}
 }%
  \newrobustcmd{\returnsym}{%
   \BeginAccSupp{method=hex,unicode,ActualText=21B5}%
   \usebox\returnbox
   \EndAccSupp{}%
  }%
 \newsavebox\shiftbox
 \sbox\shiftbox{%
   \begin{tikzpicture}
   \draw (0,0) -- (0,1ex) -- (-0.3ex,1ex) -- (0.3ex,1.6ex)
   -- (0.9ex,1ex) -- (0.6ex,1ex) -- (0.6ex,0)
    -- cycle;
   \end{tikzpicture}%
 }%
 \newrobustcmd{\shiftsym}{%
  \BeginAccSupp{method=hex,unicode,ActualText=21E7}%
   \usebox\shiftbox
  \EndAccSupp{}%
 }
}

\DeclareOption{fontsymbols}{%
  \renewcommand{\nlct@definesymbols}{%
    \nlct@definefontsymbols
  }%
}

\DeclareOption{tikzsymbols}{%
  \renewcommand{\nlct@definesymbols}{%
    \nlct@definetikzsymbols
  }%
}

\DeclareOption*{\PassOptionsToPackage{\CurrentOption}{glossaries-extra}}

\ProcessOptions

\nlct@definesymbols

\PassOptionsToPackage{hidelinks}{hyperref}
\RequirePackage{hyperref}

\RequirePackage{glossaries-extra}

% Title page information

\newcommand{\nlct@v@version}{}
\newcommand{\nlct@version}{}
\newcommand{\nlct@date}{}
\ExplSyntaxOn
\NewDocumentCommand \versiondate { m m }
{
 \tl_set:Nx \nlct@version { \tl_trim_spaces:n { #1 } }
 \tl_set:Nx \nlct@date { \tl_trim_spaces:n { #2 } }
 \tl_if_empty:NF \nlct@version
 {
   \tl_set:Nx \nlct@v@version { version ~ \nlct@version }
 }
 \tl_if_empty:NF \nlct@date
 {
   \tl_put_right:Nx  \nlct@v@version { ~ \nlct@date }
 }
 \date{\nlct@v@version}
}

\renewcommand{\title}[1]{\gdef\@title{#1}\hypersetup{pdftitle={\text_purify:n{#1}}}}

% Base bookmark level
\int_new:N \l_texjavahelp_base_bookmark_level_int

\cs_if_exist:NF \chapter
 {
   \int_set_eq:NN \l_texjavahelp_base_bookmark_level_int \c_one_int
 }
\ExplSyntaxOff

\newrobustcmd{\visiblespace}{%
  \texttt{\verbvisiblespace}%
}

\newcommand{\TeXLive}{\TeX\ Live}
\newcommand{\MikTeX}{Mik\TeX}

% Cross-referencing

\newcommand{\refslistsep}{, }
\newcommand{\refslistlastsep}{ \& }

\newcommand*{\@refslist}[4]{%
 \bgroup
  \renewcommand{\DTLlistformatitem}{\ref}%
  \renewcommand*{\DTLlistformatsep}{#2}%
  \renewcommand*{\DTLlistformatlastsep}{#3}%
  #1\DTLformatlist{#4}%
 \egroup
}

\newcommand*{\s@refslist}[4]{%
 \bgroup
  \renewcommand{\DTLlistformatitem}{\ref*}%
  \renewcommand*{\DTLlistformatsep}{#2}
  \renewcommand*{\DTLlistformatlastsep}{#3}%
  #1\DTLformatlist{#4}%
 \egroup
}

\newcommand*{\@ref@numname}[1]{\ref{#1} (\nameref{#1})}
\newcommand*{\s@ref@numname}[1]{\ref*{#1} (\nameref*{#1})}

\newcommand*{\@numname@refslist}[4]{%
 \bgroup
  \let\DTLlistformatitem\@ref@numname
  \renewcommand*{\DTLlistformatsep}{#2}%
  \renewcommand*{\DTLlistformatlastsep}{#3}%
  #1\DTLformatlist{#4}%
 \egroup
}

\newcommand*{\s@numname@refslist}[4]{%
 \bgroup
  \let\DTLlistformatitem\s@ref@numname
  \renewcommand*{\DTLlistformatsep}{#2}%
  \renewcommand*{\DTLlistformatlastsep}{#3}%
  #1\DTLformatlist{#4}%
 \egroup
}

\newcommand{\sectionrefprefix}{\S}
\newrobustcmd{\sectionref}{\@ifstar\s@sectionref\@sectionref}
\MFUblocker{\sectionref}

\newcommand*{\@sectionref}[1]{\sectionrefprefix\ref{#1}}
\newcommand*{\s@sectionref}[1]{\sectionrefprefix\ref*{#1}}

\newcommand{\Sectionrefprefix}{\S}
\newrobustcmd{\Sectionref}{\@ifstar\s@Sectionref\@sectionref}

\newcommand*{\@Sectionref}[1]{\Sectionrefprefix\ref{#1}}
\newcommand*{\s@Sectionref}[1]{\Sectionrefprefix\ref*{#1}}

\MFUaddmap{\sectionref}{\Sectionref}
\MFUaddmap{\sectionrefprefix}{\Sectionrefprefix}

\newcommand{\sectionsrefprefix}{\S\S}
\newrobustcmd{\sectionsref}{%
 \@ifstar
  {\s@refslist{\sectionsrefprefix}{\refslistsep}{\refslistlastsep}}%
  {\@refslist{\sectionsrefprefix}{\refslistsep}{\refslistlastsep}}%
}
\MFUblocker{\sectionsref}

\newcommand{\Sectionsrefprefix}{\S\S}
\newrobustcmd{\Sectionsref}{%
 \@ifstar
  {\s@refslist{\Sectionsrefprefix}{\refslistsep}{\refslistlastsep}}%
  {\@refslist{\Sectionsrefprefix}{\refslistsep}{\refslistlastsep}}%
}
\MFUaddmap{\sectionsref}{\Sectionsref}
\MFUaddmap{\sectionsrefprefix}{\Sectionsrefprefix}

\newcommand{\seealsopreskip}{\medskip}
\newcommand{\multiseealsosep}{:}

\ExplSyntaxOn
\clist_new:N \l__texjavahelp_refs_clist
\NewDocumentCommand \seealsorefs { m }
 {
   \par \seealsopreskip \par \noindent
   \MFUsentencecase { \seealsoname } 
   \clist_set:Nn \l__texjavahelp_refs_clist { #1 }
   \int_compare:nNnTF
     { \clist_count:N \l__texjavahelp_refs_clist }
      > 
     { \c_one_int }
   {
     \multiseealsosep 
     \begin { itemize }
      \clist_map_inline:Nn \l__texjavahelp_refs_clist
       {
          \item \ref { ##1 } ~ \nameref { ##1 }
       }
     \end { itemize }
   }
   {
     ~ \ref { #1 } ~ \nameref { #1 } .
   }
 }
\ExplSyntaxOff

\newcommand{\tablerefprefix}{\Tablename~}
\newcommand{\Tablerefprefix}{\Tablename~}

\newrobustcmd*{\tableref}{\@ifstar\s@tableref\@tableref}
\newrobustcmd*{\Tableref}{\@ifstar\s@Tableref\@Tableref}

\newcommand*{\@tableref}[1]{\tablerefprefix\nlct@ns@ref@cs{#1}}
\newcommand*{\s@tableref}[1]{\tablerefprefix\ref*{#1}}

\newcommand*{\@Tableref}[1]{\Tablerefprefix\nlct@ns@ref@cs{#1}}
\newcommand*{\s@Tableref}[1]{\Tablerefprefix\ref*{#1}}

\MFUaddmap{\tableref}{\Tableref}

\newcommand{\tablesrefprefix}{\tablesname~}
\newcommand{\Tablesrefprefix}{\Tablesname~}

\newrobustcmd{\tablesref}{%
 \@ifstar
  {\s@refslist{\tablesrefprefix}{\refslistsep}{\refslistlastsep}}%
  {\@refslist{\tablesrefprefix}{\refslistsep}{\refslistlastsep}}%
}

\newrobustcmd{\Tablesref}{%
 \@ifstar
  {\s@refslist{\Tablesrefprefix}{\refslistsep}{\refslistlastsep}}%
  {\@refslist{\Tablesrefprefix}{\refslistsep}{\refslistlastsep}}%
}
\MFUaddmap{\tablesref}{\Tablesref}

\newcommand{\figurerefprefix}{\figurename~}
\newcommand{\Figurerefprefix}{\Figurename~}

\newrobustcmd*{\figureref}{\@ifstar\s@figureref\@figureref}
\newrobustcmd*{\Figureref}{\@ifstar\s@Figureref\@Figureref}

\newcommand*{\@figureref}[1]{\figurerefprefix\nlct@ns@ref@cs{#1}}
\newcommand*{\s@figureref}[1]{\figurerefprefix\ref*{#1}}

\newcommand*{\@Figureref}[1]{\Figurerefprefix\nlct@ns@ref@cs{#1}}
\newcommand*{\s@Figureref}[1]{\Figurerefprefix\ref*{#1}}

\MFUaddmap{\figureref}{\Figureref}

\newcommand{\figuresrefprefix}{\figuresname~}
\newcommand{\Figuresrefprefix}{\Figuresname~}

\newrobustcmd{\figuresref}{%
 \@ifstar
  {\s@refslist{\figuresrefprefix}{\refslistsep}{\refslistlastsep}}%
  {\@refslist{\figuresrefprefix}{\refslistsep}{\refslistlastsep}}%
}

\newrobustcmd{\Figuresref}{%
 \@ifstar
  {\s@refslist{\Figuresrefprefix}{\refslistsep}{\refslistlastsep}}%
  {\@refslist{\Figuresrefprefix}{\refslistsep}{\refslistlastsep}}%
}
\MFUaddmap{\figuresref}{\Figuresref}

% \FloatFig[pos]{label}{content}[lof]{caption}
\NewDocumentCommand\FloatFig{ommom}{%
 \IfValueTF{#1}%
  {\begin{figure}[#1]}%
  {\begin{figure}}%
 \centering
 #3%
 \IfValueTF{#4}%
 {\caption[#4]{#5}}%
 {\caption{#5}}%
 \label{#2}%
 \end{figure}%
}

\newcommand{\codepar}{\par\mbox{}\par}

\newcommand{\continuesymbol}{$\hookleftarrow$}

\newcommand*{\continue@symbol}{%
 \smash{\raisebox{-1.6ex}{\makebox[0pt][r]{\continuesymbol}}}}
  
\newcommand*{\continueline}{\continue@symbol\newline}
\newcommand*{\ContExplan}{\glsentrytext{manual.cont_explanation}}

\providecommand{\examplerefprefix}{\Examplename~}
\providecommand{\Examplerefprefix}{\Examplename~}

\newrobustcmd*{\exampleref}{\@ifstar\s@exampleref\@exampleref}
\newcommand*{\@exampleref}[1]{\examplerefprefix\nlct@ns@ref@cs{#1}}
\newcommand*{\s@exampleref}[1]{\examplerefprefix\ref*{#1}}

\newrobustcmd*{\examplenameref}[1]{\exampleref{#1} (\nameref{#1})}

\newrobustcmd*{\Exampleref}{\@ifstar\s@Exampleref\@Exampleref}
\newcommand*{\@Exampleref}[1]{\Examplerefprefix\nlct@ns@ref@cs{#1}}
\newcommand*{\s@Exampleref}[1]{\Examplerefprefix\ref*{#1}}

\MFUaddmap{\exampleref}{\Exampleref}

\newcommand{\examplesrefprefix}{\examplesname~}
\newcommand{\Examplesrefprefix}{\Examplesname~}

\newrobustcmd{\examplesref}{%
 \@ifstar
  {\s@refslist{\examplesrefprefix}{\refslistsep}{\refslistlastsep}}%
  {\@refslist{\examplesrefprefix}{\refslistsep}{\refslistlastsep}}%
}

\newrobustcmd{\examplesnameref}{%
 \@ifstar
  {\s@numname@refslist{\examplesrefprefix}{\refslistsep}{\refslistlastsep}}%
  {\@numname@refslist{\examplesrefprefix}{\refslistsep}{\refslistlastsep}}%
}

\newrobustcmd{\Examplesref}{%
 \@ifstar
  {\s@refslist{\Examplesrefprefix}{\refslistsep}{\refslistlastsep}}%
  {\@refslist{\Examplesrefprefix}{\refslistsep}{\refslistlastsep}}%
}
\MFUaddmap{\examplesref}{\Examplesref}

\newrobustcmd{\mExampleref}[1]{\Exampleref{#1}\examplemarginref{#1}}
\newrobustcmd{\mexampleref}[1]{\exampleref{#1}\examplemarginref{#1}}

\newrobustcmd{\examplemarginref}[1]{%
 \marginpar{\footnotesize\hyperref[#1]{\codesym}\ref{#1}\plabel{#1-backref}}%
}

\newcommand*{\plabel}[2][]{\protected@edef\@currentlabelname{#1}\label{#2}}
\newcommand*{\pref}[2][]{on page~\pageref{#2}}
\newcommand*{\phyperref}[2]{\hyperref[#2]{#1} on page~\pageref{#2}}

% requires glossaries.sty v4.54+
\renewcommand{\glsdohypertargethook}[2]{\glslabelhypertarget{#1}{#2}}

% Examples

\newcounter{example}

\newcommand{\addtolistofexamples}[1]{%
 \addcontentsline{loe}{example}{\protect\numberline{\theexample}#1}%
}

\newenvironment{example}[2]{%
  \par\vskip10pt\noindent
  \refstepcounter{example}\label{#2}%
  {%
    \def\cmd##1{\csfmt{##1}}%
    \let\nlctexampletitlefont\nlctexampleenvtitlefont
    \nlctexampletitlefmt{#1}%
  }%
  {%
    \@loe@disable@cmds
    \addtolistofexamples{#1}%
  }%
  \nopagebreak\par\vskip10pt\nopagebreak
}
{%
  \nopagebreak\begin{center}\rule{2in}{1pt}\end{center}%
}

\newcommand{\@loe@disable@cmds}{%
  \def\dequals{\protect\dequals}%
  \def\dhyphen{\protect\dhyphen}%
  \def\dunderscore{\protect\dunderscore}%
  \def\cmd##1{\protect\csfmt{##1}}%
  \def\code##1{\protect\code{##1}}%
  \def\optfmt##1{\protect\optfmt{##1}}%
  \def\styfmt##1{\protect\styfmt{##1}}%
  \def\clsfmt##1{\protect\clsfmt{##1}}%
  \def\envfmt##1{\protect\envfmt{##1}}%
  \def\appfmt##1{\protect\appfmt{##1}}%
}

\newcommand{\nlctexampledisablecmds}{}

\newcommand{\nlctexampletag}{\Examplename~\theexample}

\newcommand{\nlctexampletitlefont}{}
\newcommand{\nlctexampleenvtitlefont}{\bfseries\large}

\newcommand{\nlctexampletitlefmt}[1]{%
  \nlctexampletitlefont
  \raggedright\exhyphenpenalty 0 % space intended
  \nlctexampletag\ifstrempty{#1}{}{: #1}\par
}

\ifdef\chapter
{
  \ifdef\titlepagestyle{\renewcommand{\titlepagestyle}{empty}}{}
  \pagenumbering{alph}

  \providecommand{\frontmatter}{\pagenumbering{roman}}
  \providecommand{\mainmatter}{\pagenumbering{arabic}}

  \newcommand{\listofexamples}{%
   \@ifstar{\chapter*{\listofexamplesname}\@starttoc{loe}}%
   {\chapter{\listofexamplesname}\listofexampleslabel\listofexamplesheader\@starttoc{loe}}}
}
{
  \newcommand{\listofexamples}{%
   \@ifstar{\section*{\listofexamplesname}\@starttoc{loe}}%
   {\section{\listofexamplesname}\listofexampleslabel\listofexamplesheader\@starttoc{loe}}}
}

% Symbols and punctuation

\newcommand*{\dash}{\,---\,}
\newcommand{\Slash}{\,\slash\,}

\newcommand*{\tick}{\ding{51}}

\newcommand*{\yes}{\ding{52}}
\newcommand*{\no}{\ding{56}}

\newrobustcmd{\advantagefmt}[1]{\textcolor{green}{#1}}
\newrobustcmd{\disadvantagefmt}[1]{\textcolor{red}{#1}}

\newcommand*{\proyes}{\advantagefmt{\yes}}
\newcommand*{\prono}{\disadvantagefmt{\no}}
 
\newcommand*{\conyes}{\disadvantagefmt{\yes}}
\newcommand*{\conno}{\advantagefmt{\no}}

\newcommand{\unlimited}{$\infty$}

{\catcode`\^^I12\relax
\gdef\nlctliteraltabchar{^^I}
}

\newcommand{\fnsymmark}[1]{\rlap{#1}}

\newcommand{\asteriskmarker}{\textasteriskcentered}
\newcommand{\daggermarker}{\textdagger}
\newcommand{\doubledaggermarker}{\textdaggerdbl}
\newcommand{\sectionmarker}{\textsection}
\newcommand{\lozengemarker}{$\lozenge$}
\newcommand{\pilcrowmarker}{\textparagraph}
\newcommand{\hashmarker}{\#}
\newcommand{\referencemarker}{{\fontfamily{cmr}\selectfont\textreferencemark}}
\newcommand{\vdoubleasteriskmarker}{\shortstack{*\\[-1.5ex]*}}
\newcommand{\starmarker}{$\star$}
\newcommand{\florettemarker}{\ding{94}}

\newcommand{\fnsymmarker}[1]{%
  \ifcase#1\relax
  \or \asteriskmarker 
  \or \daggermarker
  \or \doubledaggermarker 
  \or \sectionmarker
  \or \lozengemarker
  \or \pilcrowmarker
  \or \hashmarker
  \or \referencemarker
  \or \vdoubleasteriskmarker
  \or \starmarker
  \or \florettemarker
  \else
    \number#1
  \fi
}

\newrobustcmd*{\fnsym}{\@ifstar\s@fnsym\@fnsym}

\newcommand{\@fnsym}[1]{%
 \tablefnmark
 {%
   \fnsymmark
   {%
     \fnsymmarker{#1}%
   }%
 }%
}

\newcommand{\s@fnsym}[1]{%
 \tablefnmark
 {%
   \fnsymmarker{#1}%
 }%
}

\newcommand{\tablefns}[1]{\par
 \parbox{0.8\linewidth}
 {\raggedright
   \smallskip\hrulefill\par\smallskip
   \par#1%
 }\par
}

\newcommand*{\tablefnmark}[1]{\textsuperscript{#1}}
\newcommand{\tablefnfmt}[1]{{\footnotesize#1\par}}
\newrobustcmd{\tablefntext}[2]{\tablefnfmt{\tablefnmark{#1}#2}}
\newrobustcmd{\fnsymtext}[2]{\tablefntext{\fnsymmarker{#1}}{#2}}

\newcommand{\settabcolsep}[1]{\setlength{\tabcolsep}{#1}}

% Glossary information

\appto\glsxtrresourceinit{\GlsXtrResourceInitEscSequences}

\glsaddkey{shortswitch}{}{\shortswitchvalue}{\Shortswitchvalue}{\shortswitchref}{\Shortswitchref}{\SHORTSWITCHREF}

\glsaddstoragekey{defaultkeys}{}{\defaultkeys}
\glsaddstoragekey{syntax}{}{\syntax}
\glsaddstoragekey{defaultvalue}{}{\optdefval}
\glsaddstoragekey{initvalue}{}{\optinitval}
\glsaddstoragekey{note}{}{\note}

\glsaddstoragekey{mnemonic}{}{\entrymnemonic}
\glsaddstoragekey{tooltip}{}{\entrytooltip}
\glsaddstoragekey{keystroke}{}{\entrykeystroke}

% For icon-only buttons use the tooltip
\newdglsfield{tooltip}{\btn}
  
\renewcommand{\glslinkpresetkeys}{%
 \glsxtrifhasfield*{defaultkeys}{\glslabel}
 {\expandafter\setupglslink\expandafter{\glscurrentfieldvalue}}%
 {}%
} 

\ifdef\GlsXtrSetPlusModifier
{\GlsXtrSetPlusModifier{format=glsnumberformat}}{}

\ifdef\GlsXtrSetAltModifier
{\GlsXtrSetAltModifier{!}{format=glsignore}}{}

\setabbreviationstyle[commonabbreviation]{short-nolong}

\newignoredglossary{messages}
\newignoredglossary{keystrokes}

% punctuation is best dealt with in a separate resource set

\newcommand{\TeXJavaHelpSymbolResourceOptions}{
  group={glssymbols},
  sort=letter-case,
  selection=recorded and deps and see,
  match = {entrytype=symbol}, match-action=filter ,
  entry-type-aliases = 
   {
      punctuation=symbol,
      cspunctuation=symbol
   },
  assign-fields=
   {
     \TeXJavaHelpPuncAssignFields
   },
  save-child-count,
  symbol-sort-fallback=name,
}

\newcommand{\symbolparen}[1]{(\,#1\,)}

\newcommand{\TeXJavaHelpMaxPuncDesc}{20}
\newcommand{\TeXJavaHelpPuncAssignFields}{%
  name = symbol + " (" + description + ")"
    [ entrytype->original =/(common)?(cs)?punctuation/
      & \LEN{ description } < \TeXJavaHelpMaxPuncDesc ] ,
  name = symbol
    [ entrytype->original =/(common)?(cs)?punctuation/ ] ,
  text = description + " \cs{symbolparen}{" + symbol + "}"
    [ entrytype->original =/(common)?(cs)?punctuation/ ] 
}

\newcommand{\TeXJavaHelpGlsFieldAdjustments}{
 description-case-change=firstuc,
 post-description-dot=check
}

\newcommand{\TeXJavaHelpExtraEntryTypeAliases}{}

\newcommand{\TeXJavaHelpExtraAssignFields}{}

\newcommand{\TeXJavaHelpGlsSelection}{
  selection=recorded and deps and see,
  match-action=add,
  match={
    category=menu,
    id=manual\string\..*
  },
}

\newcommand{\TeXJavaHelpGlsResourceOptions}{
  \TeXJavaHelpGlsFieldAdjustments,
  \TeXJavaHelpGlsSelection,
  entry-type-aliases=
   {
     application=index,
     commonapplication=index,
     file=index,
     commonfile=index,
     fileext=index,
     commonfileext=index,
     package=index,
     commonpackage=index,
     class=index,
     commonclass=index,
     option=index,
     commonoption=index,
     command=index,
     commoncommand=index,
     switch=index,
     commonswitch=index,
     environment=index,
     commonenvironment=index,
     counter=index,
     commoncounter=index,
     variable=index,
     commonvariable=index,
     menu=index,
     commonmenu=index,
     menuitem=index,
     commonmenuitem=index,
     dialog=index,
     commondialog=index,
     widget=index,
     commonwidget=index,
     term=entry,
     commonterm=entry,
     commonabbreviation=abbreviation,
     message=index,
     error=index,
     warning=index,
     syntax=index,
     keystroke=symbol,
     \TeXJavaHelpExtraEntryTypeAliases
   },
  assign-fields=
   {
% applications
      name = "\cs{appfmt}{" + \MGP{1} + "}"
        [ 
           entrytype->original = /(?:common)?application/
         & entrylabel->original=/app\.(.+)/
        ], 
      name = "\cs{appfmt}{" + entrylabel->original + "}"
        [ entrytype->original = /(common)?application/ ], 
% files
      name = "\cs{filefmt}{" + \MGP{1} + "}"
        [
           entrytype->original = /(?:common)?file/
         & entrylabel->original=/file\.(.+)/
        ], 
      name = "\cs{filefmt}{" + entrylabel->original + "}"
        [ entrytype->original = /(common)?file/], 
% file extensions
      name = "\cs{filefmt}{" + \MGP{1} + "}"
        [
            entrytype->original = /(?:common)?fileext/
          & entrylabel->original=/ext\.(.+)/
        ], 
      name = "\cs{filefmt}{" + entrylabel->original + "}"
        [ entrytype->original = /(common)?fileext/], 
% variables (e.g. environment variables)
      name = "\cs{varfmt}{" + entrylabel->original + "}"
        [ entrytype->original = /(common)?variable/], 
% packages
      name = "\cs{styfmt}{" + \MGP{1} + "}"
        [
           entrytype->original =/(?:common)?package/
         & entrylabel->original=/pkg\.(.+)/
        ], 
      name = "\cs{styfmt}{" + entrylabel->original + "}"
        [ entrytype->original =/(common)?package/ ], 
% classes
      name = "\cs{clsfmt}{" + \MGP{1} + "}"
        [
           entrytype->original =/(?:common)?class/
         & entrylabel->original=/cls\.(.+)/
        ], 
      name = "\cs{clsfmt}{" + entrylabel->original + "}"
        [ entrytype->original =/(common)?class/ ], 
% options
      name = "\cs{optfmt}{" + \MGP{1} + "}"
        [
           entrytype->original =/(?:common)?option/
         & entrylabel->original=/opt\.(.+)/
        ], 
      name = "\cs{optfmt}{" + entrylabel->original + "}"
        [ entrytype->original =/(common)?option/], 
% (La)TeX commands
      name = "\cs{csfmt}{" + \MGP{1} + "}"
        [
           entrytype->original =/(?:common)?command/
         & entrylabel->original=/cs\.(.+)/
        ], 
      name = "\cs{csfmt}{" + entrylabel->original + "}"
        [ entrytype->original =/(?:common)?command/ ], 
% switches
      name = "\cs{longargfmt}{" + \MGP{1} + "}"
        [
            entrytype->original =/(?:common)?switch/
          & entrylabel->original=/switch\.(.+)/
        ], 
      name = "\cs{longargfmt}{" + entrylabel->original + "}"
        [ entrytype->original =/(common)?switch/ ], 
      shortswitch =[o] "\cs{shortargfmt}{" + shortswitch + "}"
        [ entrytype->original =/(common)?switch/ & shortswitch <> \NULL], 
% counters
      name = "\cs{ctrfmt}{" + \MGP{1} + "}"
        [
           entrytype->original =/(?:common)?counter/
         & entrylabel->original=/ctr\.(.+)/
        ], 
      name = "\cs{ctrfmt}{" + entrylabel->original + "}"
        [ entrytype->original =/(common)?counter/ ], 
% messages, errors and warnings
      type = "messages"
        [ entrytype->original = /message|error|warning|syntax/ ], 
% keystrokes
      type = "keystrokes"
        [ entrytype->original = /keystroke/ ], 
% customise
      \TeXJavaHelpExtraAssignFields 
% common
      defaultkeys = "format=glsignore"
        [ entrytype->original = /common.*/ ] ,
      category = entrytype -> original 
        [ entrytype->original = /common(abbreviation|acronym)/ ] ,
      category = \MGP{1} 
        [ entrytype->original = /common(.*)/ ] ,
      category = entrytype -> original 
   },
   save-child-count,
   symbol-sort-fallback=name,
}

% Semantic commands

\newcommand*{\widgetfmt}[1]{\textsf{\bfseries #1}}

\glsxtraddlabelprefix{action.}
\glsxtraddlabelprefix{button.}
\glsxtraddlabelprefix{menu.}
\glsxtraddlabelprefix{widget.}
\glsxtraddlabelprefix{help.}
\glsxtraddlabelprefix{}

\newdglsfieldlike[textformat=widgetfmt]{text}{\widget}{\Widget}{\WIDGET}

\newcommand{\symbolfmt}[1]{\textrm{#1}}

\newcommand{\msgparam}[1]{%
 \ifcsdef{msgparam@\romannumeral #1}%
  {\csuse{msgparam@\romannumeral #1}}%
  {\meta{param-#1}}%
}

\newcommand{\defmsgparam}[2]{\csdef{msgparam@\romannumeral #1}{#2}}

\newcommand{\msgchoiceparam}[2]{%
 [\ldots]% TODO
}

\newcommand{\msgchoiceparamitem}[3]{#3}

\newcommand{\msgellipsis}[1]{\ldots}
\newcommand{\msgendcolon}[1]{}

\ExplSyntaxOn
\NewDocumentCommand \msg { O{} m O{} }
  { \__texjavahelp_msg:nnn { #1 } { message.#2 } { #3 } }
\NewDocumentCommand \warnmsg { O{} m O{} }
  { \__texjavahelp_msg:nnn { #1 } { warning.#2 } { #3 } }
\NewDocumentCommand \errmsg { O{} m O{} }
  { \__texjavahelp_msg:nnn { #1 } { error.#2 } { #3 } }
\NewDocumentCommand \syntaxmsg { O{} m O{} }
  { \__texjavahelp_msg:nnn { #1 } { syntax.#2 } { #3 } }
\NewDocumentCommand \manmsg { O{} m O{} }
  { \__texjavahelp_msg:nnn { #1 } { manual.#2 } { #3 } }
\NewDocumentCommand \generalmsg { O{} m O{} }
  { \__texjavahelp_msg:nnn { #1 } { #2 } { #3 } }

\seq_new:N \l__texjavahelp_msg_seq

\cs_new:Nn \__texjavahelp_msg:nnn
{
  \group_begin:
   \seq_set_from_clist:Nn \l__texjavahelp_msg_seq { #1 }
   \seq_map_indexed_inline:Nn \l__texjavahelp_msg_seq
    {
      \defmsgparam { ##1 } { ##2 }
    }
   \gls{#2}[#3]%
  \group_end:
}
\ExplSyntaxOff

\newcommand*{\dialogfmt}[1]{\widgetfmt{#1}}

\NewDocumentCommand\dialog{om}{%
  \IfValueTF{#1}{\gls[#1]{#2.title}}{\gls{#2.title}}%
}

\newcommand*{\menufmt}[1]{\widgetfmt{#1}}

\newcommand*{\menusep}{\,\discretionary{}{}{}\ding{220}\,\discretionary{}{}{}}

\NewDocumentCommand\menu{sO{}O{menu.}m}{%
  \menutrail{#3#4}%
  \IfBooleanTF{#1}%
   {\glsadd[format=glsignore,#2]{#3#4}}%
   {\glsadd[#2]{#3#4}}%
}

\NewDocumentCommand\menutrail{m}{%
  \glstexorpdfstring{\@menutrail{#1}}{\glsentryname{#1}}%
}

\newcommand\@menutrail[1]{%
  \glsdoifexists{#1}%
  {%
    \glsxtrifhasfield{parent}{#1}%
    {%
       \glsifcategory{\glscurrentfieldvalue}{menu}%
       {%
         \expandafter\@menutrail\expandafter{\glscurrentfieldvalue}%
         \menusep
       }%
       {}%
    }%
    {}%
    \menuitemref{#1}%
  }%
}

\newcommand{\menuitemref}[1]{\glshyperlink{#1}}

\newcommand{\menuitem}{\dgls}

% \menutrailfmt{Parent Text,Child Text}
\newrobustcmd*{\menutrailfmt}[1]{%
  \def\nlct@menusep{}%
  \menufmt
  {%
    \@for\@menu@item:=#1\do{%
      \nlct@menusep\@menu@item
      \let\nlct@menusep\menusep
    }%
  }%
}

% key strokes
\newcommand{\keystrokefont}{\sffamily\bfseries}

\newcommand{\keystrokefmt}[1]{%
 \begin{tikzpicture}[baseline=(s.base)]
 \node[minimum height=10pt,minimum width=10pt,align=center,
   font={\keystrokefont},draw,double=lightgray,rounded corners]
 (s) {#1};
 \end{tikzpicture}%
}

\glsxtrnewgls{manual.keystroke.}{\keyref}
\newcommand{\actualkey}[1]{#1}

\newcommand{\keysep}{+}

\ExplSyntaxOn
\seq_new:N \l__texjavahelp_keys_seq

\NewDocumentCommand \keys { m }
{
  \seq_set_split:Nnn \l__texjavahelp_keys_seq { + } { #1 }
  \seq_map_indexed_inline:Nn \l__texjavahelp_keys_seq
   {
      \int_compare:nNnT { ##1 } > { \c_one_int }
       {
         \keysep
       }
      \keystrokefmt { ##2 }
   }
}
\ExplSyntaxOff

\newcommand{\appfmt}[1]{\texorpdfstring{\texttt{#1}}{#1}}
\MFUblocker{\appfmt}

\newcommand{\homedir}{\string~}
\newcommand{\homefilefmt}[1]{\filefmt{\homedir\slash#1}}

\newcommand{\filefmt}[1]{\texorpdfstring{\texttt{#1}}{#1}}
\MFUblocker{\filefmt}

\newcommand{\styfmt}[1]{\texorpdfstring{\texttt{#1}}{#1}}
\MFUblocker{\styfmt}

\newcommand{\clsfmt}[1]{\texorpdfstring{\texttt{#1}}{#1}}
\MFUblocker{\clsfmt}

\newcommand{\optfmt}[1]{\texorpdfstring{\texttt{#1}}{#1}}
\MFUblocker{\optfmt}

\newcommand*{\envfmt}[1]{\texorpdfstring{\textsf{#1}}{#1}}
\MFUblocker{\envfmt}

\newcommand*{\ctrfmt}[1]{\texorpdfstring{\textsf{#1}}{#1}}
\MFUblocker{\ctrfmt}

\newcommand*{\varfmt}[1]{\texorpdfstring{\textsf{#1}}{#1}}
\MFUblocker{\varfmt}

\newcommand*{\xmltagfmt}[1]{\texorpdfstring{\texttt{<#1>}}{\string<#1\string>}}
\MFUblocker{\xmltagfmt}

\newcommand{\longswitch}{-\/-}
\newcommand\pdflongswitch{\string-\string-}

\newcommand*{\longargfmt}[1]{%
 \texorpdfstring{\texttt{\longswitch #1}}{\pdflongswitch#1}%
}
\MFUblocker{\longargfmt}

\newcommand{\shortswitch}{\string-}

\newcommand*{\shortargfmt}[1]{\texorpdfstring{\texttt{\shortswitch#1}}{\string-#1}}
\MFUblocker{\shortargfmt}

% \defsemanticcmd[colour]{cs}{font-cs}{prefix}
\newcommand*{\defsemanticcmd}[4][]{%
  \ifstrempty{#1}%
  {%
    \ifstrempty{#3}%
    {%
      \newcommand#2[1]{#4##1}%
    }
    {%
      \newcommand#2[1]{\texorpdfstring{\fmtorcode#3{#4##1}}{#4##1}}%
    }%
  }%
  {%
    \ifstrempty{#3}%
    {%
      \newcommand#2[1]{\texorpdfstring{{\color{#1}#4##1}}{#4##1}}%
    }%
    {%
      \newcommand#2[1]{\texorpdfstring{\fmtorcode#3{\color{#1}#4##1}}{#4##1}}%
    }%
  }%
}

\newcommand{\faded}[1]{\texorpdfstring{\textcolor{gray}{#1}}{#1}}


\newcommand*{\qt}[1]{``#1''}
\newcommand*{\qtt}[1]{``\,\texttt{#1}\,''}

\newcommand*{\csfmtfont}[1]{\ifmmode \mbox{\texttt{#1}}\else\texttt{#1}\fi}
\newcommand*{\csfmtcolourfont}[1]{\texttt{\textcolor{cs}{#1}}}

\newcommand*{\csfmt}[1]{\csfmtfont{\codebackslash #1}}
\newcommand*{\cspuncfmt}[1]{\csfmt{#1}}

\newcommand{\codebackslash}{\texorpdfstring{\char`\\}{\string\\}}

\newcommand{\csmetafmt}[3]{%
 \texorpdfstring
  {\csfmt{#1\ifstrempty{#1}{}{\-}\meta{#2}\ifstrempty{#3}{}{\-}#3}}%
  {\string\\#1\string<#2\string>#3}%
}
\newcommand{\csmetametafmt}[5]{%
 \texorpdfstring{\csfmt{#1\meta{#2}#3\meta{#4}#5}}{\string\\#1\string<#2\string>#3\string<#4\string>#5}%
}

\newcommand{\starredcs}[1]{\gls{#1}[\csfmtfont{*}]}
\newcommand{\starredenv}[1]{\gls{env.#1}[\envfmt{*}]}

\newcommand{\thectr}[1]{\glslink{ctr.#1}{\csfmt{the#1}}}
\newcommand{\theHctr}[1]{\glslink{ctr.#1}{\csfmt{theH#1}}}

\newcommand*{\glscsname}[2][]{\glslink[#1]{#2}{\csfmtfont{#2}}}

\newrobustcmd*{\texmeta}[1]{{\normalfont$\langle$\emph{#1}$\rangle$}}

\newcommand*{\meta}[1]{%
 \texorpdfstring{\ifmmode\text{\texmeta{#1}}\else\texmeta{#1}\fi}{\string<#1\string>}%
}

\newcommand*{\oarg}[1]{\discretionary{}{}{}[#1]}
\newcommand*{\oargm}[1]{\oarg{\meta{#1}}}

% To prevent lonely [ and ] from upsetting the syntax highlighter:
\newrobustcmd*{\nlctopensqbracket}{[}
\newrobustcmd*{\nlctclosesqbracket}{]}

% To prevent lonely ( and ) from upsetting the syntax highlighter:
\newrobustcmd*{\nlctopenparen}{(}
\newrobustcmd*{\nlctcloseparen}{)}

\newcommand*{\marg}[1]{\texorpdfstring
 {\discretionary{}{}{}\char`\{#1\char`\} \discretionary{}{}{}}%
 {\{#1\}}%
}

\newcommand*{\margm}[1]{\marg{\meta{#1}}}

\providecommand{\glsxtrtargetorlink}[2]{%
 \GlsXtrIfFieldUndef{\glsxtrtargetfield}{#1}% 
 {%
   \@glstarget{\glolinkprefix #1}{#2}%
   \xGlsXtrSetField{#1}{\glsxtrtargetfield}{\glolinkprefix #1}%
 }{\hyperlink{\glsxtrusefield{#1}{\glsxtrtargetfield}}{#2}}%
}

\renewcommand{\glstarget}{\glsxtrtargetorlink}

\newcommand{\postclihook}{%
 \glsxtrifhasfield{syntax}{\glscurrententrylabel}%
  {\space\glscurrentfieldvalue}{}%
}

\newcommand{\postmenuhook}{%
 \glsxtrifhasfield{keystroke}{\glscurrententrylabel}%
  {\space\glscurrentfieldvalue}{}%
}

\newcommand{\main}[1]{\textbf{#1}}

\NewDocumentCommand\appdef{O{}m}{%
 \begin{terminal}[#1]%
 \glsadd[format=main]{app.#2}%
 \let\glsxtrpostnameapplication\postclihook
 \glsxtrglossentry{app.#2}%
 \end{terminal}% 
}

\newcommand{\postswitchhook}{%
 \glsxtrifhasfield{syntax}{\glscurrententrylabel}%
  {\space\glscurrentfieldvalue}{}%
 \glsxtrifhasfield{shortswitch}{\glscurrententrylabel}%
  {\space\textnormal{(or \glscurrentfieldvalue)}}{}%
}

\NewDocumentCommand\switchdef{O{}m}{%
 \begin{pinnedbox}[#1]%
 \glsadd[format=main]{switch.#2}%
 \let\glsxtrpostnameswitch\postswitchhook
 \glsxtrglossentry{switch.#2}%
 \end{pinnedbox}% 
}

\NewDocumentCommand\widgetdef{O{}mO{}}{%
 \begin{pinnedbox}[#1]%
 \glsadd[format=main]{#2}%
 \glsxtrglossentry{#2}%
 \hfill #3%
 \end{pinnedbox}% 
}

\NewDocumentCommand\pkgdef{O{}m}{%
 \begin{codebox}[#1]%
 \glsadd[format=main]{pkg.#2}%
 \cmd{usepackage}%
 \glsxtrifhasfield{syntax}{#2}{\oarg{\glscurrentfieldvalue}}{}%
 \marg{\glsxtrglossentry{pkg.#2}}%
 \end{codebox}% 
}

\NewDocumentCommand\clsdef{O{}m}{%
 \begin{codebox}[#1]%
 \cmd{documentclass}%
 \glsadd[format=main]{cls.#2}%
 \glsxtrifhasfield{syntax}{#2}{\oarg{\glscurrentfieldvalue}}{}%
 \marg{\glsxtrglossentry{cls.#2}}%
 \end{codebox}% 
}

\NewDocumentCommand\cmddef{O{}m}{%
 \begin{codebox}[#1]%
 \glsadd[format=main]{#2}%
 \glsxtrglossentry{#2}%
 \glsxtrifhasfield{syntax}{#2}{\glscurrentfieldvalue}{}%
 \end{codebox}% 
}

\newcommand{\postoptionhook}{%
 \glsxtrifhasfield{syntax}{\glscurrententrylabel}{=\glscurrentfieldvalue}{}%
}

\NewDocumentCommand\optiondef{O{}m}{%
 \begin{compactcodebox}[#1]%
 \glsadd[format=main]{opt.#2}%
 \let\glsxtrpostnameoption\postoptionhook
 \glsxtrglossentry{opt.#2}%
 \end{compactcodebox}% 
}

\newrobustcmd*{\inlineglsdef}[1]{%
 \glsadd[format=main]{#1}%
 \glsxtrglossentry{#1}%
}

\newcommand*{\filetext}[1]{\glsfmttext{file.#1}}
\newcommand*{\stytext}[1]{\glsfmttext{pkg.#1}}
\newcommand*{\clstext}[1]{\glsfmttext{cls.#1}}
\newcommand*{\opttext}[1]{\glsfmttext{opt.#1}}
\newcommand*{\envtext}[1]{\glsfmttext{env.#1}}
\newcommand*{\ctrtext}[1]{\glsfmttext{ctr.#1}}
\newcommand*{\actext}[1]{\glsfmttext{dual.#1}}
\newcommand*{\exttext}[1]{\glsfmttext{ext.#1}}
\newcommand*{\apptext}[1]{\glsfmttext{app.#1}}
\newcommand*{\switchtext}[1]{\glsfmttext{switch.#1}}

\glsxtrnewgls{file.}{\file}
\glsxtrnewgls{pkg.}{\sty}
\glsxtrnewgls{cls.}{\cls}
\glsxtrnewgls{opt.}{\opt}
\glsxtrnewgls{env.}{\env}
\glsxtrnewgls{ctr.}{\ctr}
\glsxtrnewgls{dual.}{\ac}
\glsxtrnewgls{ext.}{\ext}
\glsxtrnewgls{app.}{\app}
\glsxtrnewgls{switch.}{\switch}
\newcommand{\swch}[2][]{\shortswitchref[#1]{switch.#2}}

\newcommand{\optval}[2]{%
 \texorpdfstring
  {\gls{opt.#1}\optfmt{\dequals#2}}%
  {\glsentrytext{opt.#1}=#2}%
}

\newcommand{\optvalm}[2]{%
 \texorpdfstring
  {\gls{opt.#1}\optfmt{\dequals\marg{#2}}}%
  {\glsentrytext{opt.#1}=\marg{#2}}%
}

% discretionary commands (allow a line break)

% put break before dash to avoid confusion with a hyphen
\newcommand{\dhyphen}{%
 \texorpdfstring
 {\discretionary{}{}{}\texttt{-}}%
 {-}%
} 
  
% Redefine \- (used in entry names) so that hyphenation in command names, 
% switches, options etc., uses a serif hyphen to reduce confusion with an 
% actual hyphen in the code.

\renewrobustcmd{\-}{%
 \discretionary
 {{\rmfamily\char\ifnum\hyphenchar\font<0
  \defaulthyphenchar\else\hyphenchar\font\fi
 }}%
 {}{}%
}

\newcommand{\dequals}{%
 \texorpdfstring
 {\discretionary{}{}{}\texttt{=}\discretionary{}{}{}}%
 {=}%
} 

\newcommand{\dcomma}{%
 \texorpdfstring
 {\texttt{,}\discretionary{}{}{}}%
 {,}%
}

\newcommand{\dcolon}{%
 \texorpdfstring
 {\texttt{:}\discretionary{}{}{}}%
 {:}%
}

\newcommand{\dfullstop}{%
 \texorpdfstring
 {\texttt{.}\discretionary{}{}{}}%
 {.}%
}

\newcommand{\dunderscore}{%
 \texorpdfstring
 {\discretionary{}{}{}\texttt{\_}\discretionary{}{}{}}%
 {\_}%
}

\pdfstringdefDisableCommands{%
  \def\dhyphen{-}%
  \def\dcolon{:}%
  \def\dcomma{,}%
  \def\dequals{=}%
  \def\dfullstop{.}%
  \def\dunderscore{\_}%
  \let\-\empty
  \let\csfmtfont\@firstofone
}

\newignoredglossary{minilist}

\newcommand{\glssummaryadd}[1]{\glsadd{#1}}

\ExplSyntaxOn

\NewDocumentCommand \listentry { O{} m }
{
 \group_begin:
   \ifglsentryexists { #2 }
    {
     \__texjavahelp_hier_copy:ne { minilist } { #2 }
     \listentrydescendentsinit
     \let \glsextrapostnamehook \glssummaryadd
     \printunsrtglossary 
     [
        type=minilist,
        style=topic,
        title = { \glsfmttext{#2} ~ \summaryname},
        nonumberlist,
        leveloffset = { - \glsxtrusefield { #2 } { level } } ,
        label={#2-summary},
        #1
     ]
    }
    { \glsadd { #2 } }
 \group_end:
}

\newcommand{\listentrydescendentsinit}{
  \cs_set_eq:NN \glsxtrpostnameapplication \postclihook
  \cs_set_eq:NN \glsxtrpostnameswitch \postswitchhook
  \cs_set_eq:NN \glsxtrpostnameoption \postoptionhook
  \cs_set_eq:NN \glsxtrpostnamemenu \postmenuhook
  \cs_set_eq:NN \glstopicSubItemBox \use_ii:nn
}

\NewDocumentCommand \listentrydescendents { O{} m }
{
 \group_begin:
  \ifglsentryexists { #2 }
   {
    \glsxtrifhasfield* { childlist } { #2 }
     {
      \cs_set:Npn \do ##1
       {
         \__texjavahelp_hier_copy:nn { minilist } { ##1 }
       }
      \glsxtrfielddolistloop { #2 } { childlist }
     } 
     { }
    \listentrydescendentsinit
    \let \glsextrapostnamehook \glssummaryadd
    \printunsrtglossary 
     [
        preamble={ \glssummaryadd { #2 } },
        type=minilist,
        label={#2-summary},
        style=topic,
        title = { \glsfmttext{#2} ~ \summaryname},
        nonumberlist,
        leveloffset = { \int_eval:n { - \glsxtrusefield { #2 } { level } - 1 } } ,
        #1
     ]
   }
   { \glsadd { #2 } }
 \group_end:
}

\NewDocumentCommand \listmenuitems { O{} m }
{
 \group_begin:
  \ifglsentryexists { #2 }
   {
    \glsxtrifhasfield* { childlist } { #2 }
     {
      \cs_set:Npn \do ##1
       {
         \__texjavahelp_hier_copy:nn { minilist } { ##1 }
       }
      \glsxtrfielddolistloop { #2 } { childlist }
     } 
     { }
    \printunsrtglossary 
     [
        preamble={ \glssummaryadd { #2 } },
        type=minilist,
        label={#2-summary},
        style=menuitems,
        title = { \glsfmttext{#2} ~ \summaryname},
        nonumberlist,
        leveloffset = { \int_eval:n { - \glsxtrusefield { #2 } { level } - 1 } } ,
        #1
     ]
   }
   { \glsadd { #2 } }
 \group_end:
}

\newcommand{\menuitemsbetweenskip}{\medskip}
\newcommand{\menusbetweenskip}{\bigskip}
\int_new:N \l__texjavahelp_prev_level_int

\NewDocumentCommand \menubookmark { m }
 {
   \pdfbookmark
    [ \int_eval:n { \l_texjavahelp_base_bookmark_level_int + \c_one_int } ]
    { \glsentryname { #1 } } { menusummary.#1 } 
 }

\newglossarystyle{menuitems}
{%
  \renewenvironment{theglossary}%
    {\setlength{\parindent}{0pt}%
     \setlength{\parskip}{0pt plus 0.3pt}%
     \int_set:Nn \l__texjavahelp_prev_level_int { - \c_one_int }
    }%
  {\par}%
  \renewcommand*{\glossaryheader}{}%
  \renewcommand*{\glsgroupheading}[1]{}%
  \renewcommand{\glossentry}[2]{\subglossentry{0}{##1}{##2}}%
  \renewcommand*{\subglossentry}[3]{%
    \int_compare:nNnF
      { \l__texjavahelp_prev_level_int } < { \c_zero_int }
    {
       \int_if_zero:nTF { ##1 }
        { \menusbetweenskip }
        { \menuitemsbetweenskip }
    }
    \int_set:Nn \l__texjavahelp_prev_level_int { ##1 }
    \par
    \int_if_zero:nT { ##1 }
     {
       \menubookmark { ##2 }
     }
    \glssummaryadd{##2}\menutrail{##2}\hfill\glsxtrusefield{##2}{keystroke}\par
    \ifglshasdesc{##2}{\Glossentrydesc{##2}\glspostdescription}%
    {
      \glsxtrifhasfield {tooltip} { ##2 }
       {
         \xmakefirstuc\glscurrentfieldvalue\glspostdescription
       }
       { }
    }
  }%
  \renewcommand*{\glsgroupskip}{}%
}

\cs_new:Nn \__texjavahelp_hier_copy:nn
{
  \glsxtrcopytoglossary { #2 } { #1 }
  \glsxtrifhasfield* { childlist } { #2 }
  {
    \cs_set:Npn \do ##1
     {
       \__texjavahelp_hier_copy:nn { #1 } { ##1 }
     }
    \glsxtrfielddolistloop { #2 } { childlist }
  } 
  { }
}
\cs_generate_variant:Nn \__texjavahelp_hier_copy:nn { ne }

\dim_new:N \l__texjavahelp_width_dim

\cs_new:Nn \__texjavahelp_update_widest:n
{
  \glsmeasurewidth \l__texjavahelp_width_dim
    { \glstreenamefmt { \glossentryname { #1 } } \quad } 
  \dim_compare:nNnT { \l__texjavahelp_width_dim } > { \glsxtrtreetopindent }
   {
     \dim_set_eq:NN \glsxtrtreetopindent  \l__texjavahelp_width_dim 
   }
}

\newcommand{\ifterm}[3]{%
 \glsifcategory{#1}{abbreviation}{#2}%
 {\glsifcategory{#1}{term}{#2}{#3}}%
}

\newcommand{\filterterms}[1]{%
  \ifterm{#1}{}{\printunsrtglossaryskipentry}%
}

\newcommand{\filtermeasureterms}[1]{%
  \ifterm { #1 }
  { \__texjavahelp_update_widest:n { #1 } }
  { \printunsrtglossaryskipentry }
}

\newcommand{\printmaininit}{
  \dim_zero:N \glsxtrtreetopindent
  \renewcommand{\glsxtralttreeInit}{\glsxtrAltTreeIndent=\parindent}
  \let\printunsrtglossaryentryprocesshook\filtermeasureterms
}

% This command prints a list of terms but is set up for childless entries
\NewDocumentCommand \printmain { O{} }
{
  \group_begin:
    \printmaininit
    \printunsrtglossary[label=glossary,nogroupskip,nonumberlist,style=alttree,#1]%
  \group_end:
}

\ExplSyntaxOff

\newcommand{\manualtext}[2]{%
 \ifglsentryexists{manual.#1}{\glsentrytext{manual.#1}}{#2}
}
\newcommand{\Manualtext}[2]{%
 \ifglsentryexists{manual.#1}{\Glsentrytext{manual.#1}}{#2}
}
\newcommand{\ManualText}[2]{\Manualtext{#1}{\makefirstuc{#2}}}
\MFUaddmap{\manualtext}{\ManualText}

\newcommand{\manualplural}[2]{%
 \ifglsentryexists{manual.#1}{\glsentryplural{manual.#1}}{#2}
}
\newcommand{\Manualplural}[2]{%
 \ifglsentryexists{manual.#1}{\Glsentryplural{manual.#1}}{#2}
}
\newcommand{\ManualPlural}[2]{\Manualplural{#1}{\makefirstuc{#2}}}
\MFUaddmap{\manualplural}{\ManualPlural}

\newcommand{\manualdesc}[2]{%
 \ifglsentryexists{manual.#1}{\glsentrydesc{manual.#1}}{#2}
}
\newcommand{\Manualdesc}[2]{%
 \ifglsentryexists{manual.#1}{\Glsentrydesc{manual.#1}}{#2}
}
\newcommand{\ManualDesc}[2]{\Manualdesc{#1}{\makefirstuc{#2}}}
\MFUaddmap{\manualdesc}{\ManualDesc}

\renewcommand{\figurename}{\manualtext{figure}{figure}}
\newcommand{\figuresname}{\manualplural{figure}{figures}}
\newcommand{\Figurename}{\Manualtext{figure}{Figure}}
\newcommand{\Figuresname}{\Manualplural{figure}{Figures}}

\renewcommand{\tablename}{\manualtext{table}{table}}
\newcommand{\tablesname}{\manualplural{table}{tables}}
\newcommand{\Tablename}{\Manualtext{table}{Table}}
\newcommand{\Tablesname}{\Manualplural{table}{Tables}}

\newcommand{\listofexamplesname}{\manualtext{listofexamples}{Examples}}
\renewcommand{\contentsname}{\manualtext{contents}{Contents}}
\renewcommand{\glossaryname}{\manualtext{glossary}{Glossary}}
\renewcommand{\abbreviationsname}{\manualtext{abbreviations}{Abbreviations}}
\renewcommand{\glssymbolsgroupname}{\manualtext{glssymbolsgroup}{Symbols}}
\renewcommand{\indexname}{\manualtext{index}{Index}}

\newcommand{\summaryname}{\manualtext{summary}{Summary}}

\newcommand{\sectionname}{\manualtext{section}{section}}

\newcommand{\examplename}{\manualtext{example}{example}}
\newcommand{\Examplename}{\Manualtext{example}{Example}}
\newcommand{\examplesname}{\manualplural{example}{examples}}
\newcommand{\Examplesname}{\Manualplural{example}{Examples}}

\renewcommand{\seealsoname}{\manualtext{seealso}{see also}}

\newcommand{\idxpackagename}{\manualtext{idxpackage}{package}}
\newcommand{\idxclassname}{\manualtext{idxclass}{class}}
\newcommand{\idxenvname}{\manualtext{idxenv}{environment}}
\newcommand{\idxcountername}{\manualtext{idxcounter}{counter}}

\newcommand{\nlctguideindexinitpostnamehooks}{%
  \glsdefpostname{abbreviation}{\abbrpostnamehook}%
  \glsdefpostname{package}{ \idxpackagename}%
  \glsdefpostname{class}{ \idxclassname}%
  \glsdefpostname{environment}{ \idxenvname}%
  \glsdefpostname{counter}{ \idxcountername}%
}

\NewDocumentCommand\printindex{O{}}{%
  {%
    \nlctguideindexinitpostnamehooks
    \printunsrtglossary[label=docindex,style=bookindex,title=\indexname]%
  }%
}

\newcommand{\abbrpostnamehook}{%
  \ifglshaslong\glscurrententrylabel
  {\space (\glsfmtlong{\glscurrententrylabel})}%
  {}%
}

% logos

\newcommand*{\BibTeX}{\hologo{BibTeX}}
\newcommand*{\eTeX}{\hologo{eTeX}}
\newcommand*{\XeLaTeX}{\hologo{XeLaTeX}}
\newcommand*{\LuaLaTeX}{\hologo{LuaLaTeX}}
\newcommand*{\pdfLaTeX}{\hologo{pdfLaTeX}}
\newcommand*{\LuaTeX}{\hologo{LuaTeX}}
\newcommand*{\XeTeX}{\hologo{XeTeX}}
\newcommand*{\pdfTeX}{\hologo{pdfTeX}}


% tcolorbox Boxes

\newlength\boxtitleshift
\setlength{\boxtitleshift}{-2.5mm}

\newcommand*{\warningsym}{\faExclamationTriangle}
\newcommand*{\warningtext}{\manualtext{warning}{Warning}}
\newcommand*{\warningdesc}{\manualdesc{warning}{a warning}}

\newcommand*{\importantsym}{\faInfo}
\newcommand*{\importanttext}{\manualtext{important}{Important}}
\newcommand*{\importantdesc}{\manualdesc{important}{an important message}}

\newcommand*{\informationsym}{\faInfoCircle}
\newcommand*{\informationtext}{\manualtext{information}{Information}}
\newcommand*{\informationdesc}{\manualdesc{information}{prominent information}}

\newcommand*{\definitionsym}{\faThumbTack}
\newcommand*{\definitiontext}{\manualtext{definition}{Definition}}
\newcommand*{\definitiondesc}{\manualtext{definition}{the syntax 
and usage of a command, environment or option etc}}

\newcommand*{\valuesettingsym}{\faSliders}
\newcommand*{\valuesettingtext}{\manualtext{valuesetting}{Setting}}
\newcommand*{\valuesettingdesc}{\manualdesc{valuesetting}{an option
that takes a value}}

\newcommand*{\novaluesettingsym}{\faBars}
\newcommand*{\novaluesettingtext}{\manualtext{novaluesetting}{Valueless Setting}}
\newcommand*{\novaluesettingdesc}{\manualdesc{novaluesetting}{an
option that doesn't take a value}}

\newcommand*{\toggleonsettingsym}{\faToggleOn}
\newcommand*{\toggleonsettingtext}{\manualtext{toggleonsetting}{Toggle (On)}}
\newcommand*{\toggleonsettingdesc}{\manualdesc{toggleonsetting}{a
boolean option that is initially true}}

\newcommand*{\toggleoffsettingsym}{\faToggleOff}
\newcommand*{\toggleoffsettingtext}{\manualtext{toggleoffsetting}{Toggle (Off)}}
\newcommand*{\toggleoffsettingdesc}{\manualdesc{toggleoffsetting}{a
boolean option that is initially false}}

\newcommand*{\optionvaluesym}{\faTag}
\newcommand*{\optionvaluetext}{\manualtext{optionvaluedef}{Option Value Definition}}
\newcommand*{\optionvaluedesc}{\manualdesc{optionvaluedef}{the
definition of an option value}}

\newcommand*{\countersym}{\textnumero}
\newcommand*{\countertext}{\manualtext{counterdef}{Counter}}
\newcommand*{\counterdesc}{\manualdesc{counterdef}{a counter is
being described}}

\definecolor{banned}{rgb}{0.8,0,0}

\newrobustcmd{\deprecatedorbannedfmt}[1]{\textcolor{banned}{#1}}

\newcommand*{\deprecatedsym}{\deprecatedorbannedfmt{\faTrashO}}
\newcommand*{\deprecatedtext}{\manualtext{deprecated}{Deprecated}}
\newcommand*{\deprecateddesc}{\manualdesc{deprecated}{a command, environment or option that
is now deprecated}}

\newcommand*{\bannedsym}{\deprecatedorbannedfmt{\faBan}}
\newcommand*{\bannedtext}{\manualtext{banned}{Don't use}}
\newcommand*{\banneddesc}{\manualdesc{banned}{a command, environment or option that
should not be used with \thispackage}}

\newcommand*{\terminalsym}{\faTerminal}
\newcommand*{\terminaltext}{\manualtext{terminal}{Terminal}}
\newcommand*{\terminaldesc}{\manualdesc{terminal}{a command-line application invocation
that needs to be entered into a
\href{https://www.dickimaw-books.com/latex/novices/html/terminal.html}{terminal
or command prompt}}}

\newcommand*{\codesym}{\faFileTextO}
\newcommand*{\codetext}{\manualtext{codeinput}{Input}}
\newcommand*{\codedesc}{\manualdesc{codeinput}{\LaTeX\ code to
insert into your document}}

\newrobustcmd*{\badcodesym}{\faFileTextO\llap{\deprecatedorbannedfmt{\scriptsize\faBan}}}
\newcommand*{\badcodetext}{\manualtext{badcode}{Problematic Input}}
\newcommand*{\badcodedesc}{\manualdesc{badcode}{problematic code
which should be avoided}}

\newrobustcmd*{\unicodesym}{\faFileO\llap{\textsl{\tiny Uni}}}
\newcommand*{\unicodetext}{\manualtext{unicodeinput}{Unicode Input}}
\newcommand*{\unicodedesc}{\manualdesc{unicodeinput}{code that requires a native Unicode
engine (\XeLaTeX\ or \LuaLaTeX)}}

\newcommand*{\resultsym}{\faFilePdfO}
\newcommand*{\resulttext}{\manualtext{coderesult}{Result}}
\newcommand*{\resultdesc}{\manualdesc{coderesult}{how the example
code should appear in the PDF}}

\newcommand*{\transcriptsym}{\twemoji{1f50e}}
\newcommand*{\transcripttext}{\manualtext{transcript}{Transcript}}
\newcommand*{\transcriptdesc}{\manualdesc{transcript}{text in a
transcript or log file or written to STDOUT or STDERR}}

\newcommand*{\icon}[1]{\csuse{#1sym}}
\newcommand*{\icontext}[1]{\csuse{#1text}}
\newcommand*{\icondesc}[1]{\csuse{#1desc}}

\newtcolorbox{warning}[1][]{breakable,
 before upper={\parindent12pt\noindent},
 title={\icon{warning}},
 coltitle=red,colbacktitle=red!20!white,
 colframe=red,colback=red!5!white,
 enhanced,attach boxed title to top right={yshift=\boxtitleshift},#1}

\newtcolorbox{important}[1][]{breakable,title={\icon{important}},
 before upper={\parindent12pt\noindent},
 coltitle=red,colbacktitle=red!20!white,
 colframe=red,colback=red!5!white,
 enhanced,attach boxed title to top right={yshift=\boxtitleshift},#1}

\newtcolorbox{information}[1][]{breakable,title={\icon{information}},
 before upper={\parindent12pt\noindent},
 coltitle=teal,colbacktitle=teal!20!white,
 colframe=teal,colback=teal!5!white,
 enhanced,attach boxed title to top right={yshift=\boxtitleshift},#1}

% NB These boxes aren't set up for verbatim

\definecolor{defbackground}{rgb}{1,1,0.75}
\definecolor{optiondefbackground}{rgb}{1,1,0.89}
\definecolor{optionvaluedefbackground}{rgb}{1,1,0.96}

\newcommand{\nlctdefaultafter}{\par\noindent\ignorespacesafterend}

\newcommand{\nlctpinnedafter}{\nlctdefaultafter} 
\newcommand{\nlctpinnedbefore}{\allowbreak\par\noindent} 

\newtcolorbox{pinnedbox}[1][]{unbreakable,title={\icon{definition}},
 coltitle=black,colbacktitle=defbackground,
 colframe=black,colback=defbackground,halign=flush left,
 enhanced,attach boxed title to top right={yshift=\boxtitleshift},
 after={\nlctpinnedafter},before={\nlctpinnedbefore},
 #1
}

\newcommand{\nlctdefnafter}{\nopagebreak\nlctdefaultafter}
\newcommand{\nlctdefnbefore}{\allowbreak\par\noindent}

\newtcolorbox{defnbox}[1][]{unbreakable,
 colframe=black,colback=defbackground,halign=flush left,
 after={\nlctdefnafter},before={\nlctdefnbefore},
 #1
}

\newcommand{\nlctsettingsafter}{\nopagebreak\nlctdefaultafter}
\newcommand{\nlctsettingsbefore}{\allowbreak\par\noindent}

\newtcolorbox{settingsbox}[1][]{title={\icon{valuesetting}},unbreakable,
 coltitle=black,colbacktitle=defbackground!20!white,
 colframe=black,colback=defbackground!20!white,halign=flush left,
 enhanced,attach boxed title to top right={yshift=\boxtitleshift},
 after={\nlctsettingsafter}, before={\nlctsettingsbefore},
 #1
}

\newtcolorbox{terminal}[1][]{unbreakable,title={\icon{terminal}},
 colframe=black,
 enhanced,attach boxed title to top right={yshift=\boxtitleshift},
 after={\nlctdefaultafter},
 halign=flush left,fontupper=\ttfamily,before upper={\frenchspacing\obeylines},
 #1
}

\newtcolorbox{transcript}{unbreakable,title={\icon{transcript}},
 colframe=black,
 enhanced,attach boxed title to top right={yshift=\boxtitleshift},
 after={\nlctdefaultafter},
 halign=flush left,fontupper=\ttfamily,before upper={\frenchspacing\obeylines}
}

\newcommand{\code@cmd}[1]{\char`\\ #1}
\newcommand{\cmd}[1]{\texttt{\code@cmd{#1}}}
\newcommand{\code@cbeg}[1]{\cmd{begin}\marg{#1}}
\newcommand{\code@cend}[1]{\cmd{end}\marg{#1}}
{\obeylines\newcommand{\code@comment}[1]{%
 \mbox{\textcolor{comment}{\glspercentchar\ #1}}\@ifnextchar
{}{\par}}\global\let\code@comment\code@comment\newcommand{\code@comment@dbsp}[1]{%
 \mbox{\textcolor{comment}{\glspercentchar\ #1}}\@ifnextchar
{}{\par}\dbspace}\global\let\code@comment@dbsp\code@comment@dbsp}
\newcommand{\araraline}[1]{\glspercentchar\ arara: #1}
\newcommand{\araracont}{\araraline{-\/-> }}

\definecolor{cs}{rgb}{.328,.436,.1} % dark green
\definecolor{comment}{rgb}{0.37,0.37,0.37}% grey

\newcommand*{\setupcodeenvfmts}{%
 \let\cbeg\code@cbeg
 \let\cend\code@cend
 \let\comment\code@comment
 \let\commentdbsp\code@comment@dbsp
 \def\nl{\mbox{}\newline}%
 \def\nlsp{\nl\null\space}%
 \def\dbspace{\mbox{}\space\space}%
 \def\dbdbspace{\dbspace\dbspace}%
 \def\dbdbdbspace{\dbspace\dbspace\dbspace}%
 \def\nldbsp{\nl\null\dbspace}%
 \def\nldbdbsp{\nl\null\dbdbspace}%
 \def\nlsbdbdbsp{\nl\null\dbdbdbspace}%
 \renewcommand*{\envfmt}[1]{##1}%
 \renewcommand*{\styfmt}[1]{##1}%
 \renewcommand*{\clsfmt}[1]{##1}%
 \renewcommand*{\ctrfmt}[1]{##1}%
 \renewcommand*{\csfmtfont}[1]{\textcolor{cs}{##1}}%
 \let\fmtorcode\@secondoftwo
 \let\code\@firstofone
}

\newcommand*{\initcodeenv}{%
 \GlsXtrStartUnsetBuffering
 \setupcodeenvfmts
 \obeylines\frenchspacing\@vobeyspaces
 \parindent\z@\parfillskip\@flushglue
}

\newcommand{\codefont}{\ttfamily}

% inline
\newcommand{\code}[1]{\texorpdfstring{\@code{#1}}{#1}}
\newrobustcmd{\@code}[1]{{\setupcodeenvfmts\codefont\obeyspaces #1}}

\definecolor{codebackground}{gray}{0.95}

\newtcolorbox{codebox}[1][]{title={\icon{code}},
 enhanced,breakable,attach boxed title to top right={yshift=\boxtitleshift},
 halign=flush left,fontupper=\codefont,colback=codebackground,
  before upper={%
  \preto\glslinkpresetkeys{\setkeys{glslink}{format=glsignore}}%
  \initcodeenv
  },
  after upper={\GlsXtrDiscardUnsetBuffering},
  after={\nlctdefaultafter},
  #1
}

\newtcolorbox{codebox*}[1][]{title={\icon{code}},
 enhanced,breakable,
 attach boxed title to top right={yshift=\boxtitleshift},
 halign=flush left,fontupper=\codefont,colback=codebackground,
  before upper={\initcodeenv},
  after upper={\GlsXtrDiscardUnsetBuffering},
  after={\nlctdefaultafter},
  #1
}

\newenvironment{badcodebox}%
{\begin{codebox}[title={\icon{badcode}}]}
{\end{codebox}\noindent\ignorespacesafterend}

\newenvironment{unicodebox}%
{\begin{codebox}[title={\icon{unicode}}]}
{\end{codebox}\noindent\ignorespacesafterend}

\newtcolorbox{compactcodebox}[1][]{%
  halign=flush left,fontupper=\codefont,colback=codebackground,
  before upper={%
  \renewcommand{\glslinkpresetkeys}{\setkeys{glslink}{format=glsignore}}%
  \initcodeenv},
  after upper={\GlsXtrDiscardUnsetBuffering},
  after={\nlctdefaultafter},
  #1
}

\newtcolorbox{compactcodebox*}[1][]{%
  halign=flush left,fontupper=\codefont,colback=codebackground,
  before upper={\initcodeenv},
  after upper={\GlsXtrDiscardUnsetBuffering},
  after={\nlctdefaultafter},
  #1
}

\newcommand*{\result@attachtag}{}

\newtcolorbox{resultbox}[1][]{title={\icon{result}},
 coltitle=black,colbacktitle=white,
 colframe=black,colback=white,
 after={\nlctdefaultafter},
 enhanced,attach boxed title to top right={yshift=\boxtitleshift},#1}

\newtcolorbox{coderesult}[1][]{skin=bicolor,
title={\icon{code} \icon{result}},
attach boxed title to top center={yshift=\boxtitleshift},
sidebyside,
sidebyside align=top,
colbacklower=white,
fontupper=\codefont,
before upper={%
\renewcommand{\glslinkpresetkeys}{\setkeys{glslink}{format=glsignore}}%
  \initcodeenv},
after upper={\GlsXtrDiscardUnsetBuffering},
halign upper=flush left,halign lower=justify,
valign upper=top,valign lower=top,
after lower={\noindent},
#1
}

\newtcolorbox{coderesult*}[1][]{skin=bicolor,
title={\icon{code} \icon{result}},
attach boxed title to top center={yshift=\boxtitleshift},
sidebyside,
sidebyside align=top,
colbacklower=white,
fontupper=\codefont,
before upper={\initcodeenv},
after upper={\GlsXtrDiscardUnsetBuffering},
after lower={\noindent},
valign upper=top,valign lower=top,
halign upper=flush left,halign lower=justify,
#1
}

\newenvironment{unicoderesult}%
{\begin{coderesult}[title={\icon{unicode} \icon{result}}]}
{\end{coderesult}\noindent\ignorespacesafterend}

\newenvironment{unicoderesult*}%
{\begin{coderesult*}[title={\icon{unicode} \icon{result}}]}
{\end{coderesult*}\noindent\ignorespacesafterend}

\ExplSyntaxOn
\box_new:N \l__texjavahelp_img_box
\tl_new:N \l__texjavahelp_img_width_tl
\tl_new:N \l__texjavahelp_img_height_tl

\cs_new:Nn \__texjavahelp_img_apply_resize:
{
  \tl_if_empty:NTF \l__texjavahelp_img_width_tl 
  {
    \tl_if_empty:NF \l__texjavahelp_img_height_tl 
     {
       \box_resize_to_ht:Nn
        \l__texjavahelp_img_box { \l__texjavahelp_img_height_tl }
     }
    \tl_clear:N \l__texjavahelp_img_height_tl
  }
  {
    \tl_if_empty:NTF \l__texjavahelp_img_height_tl 
     {
       \box_resize_to_wd:Nn
        \l__texjavahelp_img_box { \l__texjavahelp_img_width_tl }
     }
     {
       \box_resize_to_wd_and_ht:Nnn
        \l__texjavahelp_img_box
         { \l__texjavahelp_img_width_tl }
         { \l__texjavahelp_img_height_tl }
       \tl_clear:N \l__texjavahelp_img_height_tl
     }
    \tl_clear:N \l__texjavahelp_img_width_tl
  }
}

\keys_define:nn { texjavahelp / img }
 {
    scale .code:n = 
     {
       \__texjavahelp_img_apply_resize:
       \box_scale:Nnn  \l__texjavahelp_img_box { #1 } { #1 }
     },
    angle .code:n = 
     {
       \__texjavahelp_img_apply_resize:
       \box_rotate:Nnn  \l__texjavahelp_img_box { #1 } 
     },
    width .tl_set:N = \l__texjavahelp_img_width_tl ,
    height .tl_set:N = \l__texjavahelp_img_height_tl ,
    alt .code:n = { }
 }

\tl_new:N \l__texjavahelp_img_dir_tl
\tl_new:N \l__texjavahelp_img_name_tl
\tl_new:N \l__texjavahelp_img_ext_tl

\NewDocumentCommand \includeimg { o m }
{
  \group_begin:
   \GlsXtrAppToDefaultGlsOpts { noindex }
   \file_parse_full_name:nNNN { #2 } 
     \l__texjavahelp_img_dir_tl
     \l__texjavahelp_img_name_tl
     \l__texjavahelp_img_ext_tl
   \file_if_exist:nTF { #2 .tex }
    {
      \seq_put_right:NV \l_file_search_path_seq \l__texjavahelp_img_dir_tl
      \IfValueTF { #1 }
       {
         \hbox_set:Nn \l__texjavahelp_img_box
          { \file_input:n { #2 } }
         \keys_set:nn { texjavahelp / img } { #1 }
         \__texjavahelp_img_apply_resize:
         \mbox { \box_use:N \l__texjavahelp_img_box }
       }
       {
         \file_input:n { #2 }
       }
    }
    {
      \IfValueTF { #1 }
       { \includegraphics [ #1 ] { #2 } }
       { \includegraphics { #2 } }
    }
  \group_end:
}
\ExplSyntaxOff

\newcommand{\texparserimgloadresources}[2][]{%
  \ifnum\glsxtrresourcecount=0\relax
    \glsxtrresourcefile[#1]{#2}%
  \else
    \glsxtrresourcefile[#1]{#2-\the\glsxtrresourcecount}%
  \fi
  \advance\glsxtrresourcecount by 1\relax
}
\newcommand{\texparserimgfile}[1]{%
  \hypersetup{hidelinks}%
  \pagestyle{empty}%
  {\makeatletter
    \InputIfFileExists{#1.aux}{}{}%
  }%
  \nofiles
}

\endinput
